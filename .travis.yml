sudo: false
language: android
dist: trusty
android:
  components:
     # Uncomment the lines below if you want to
     # use the latest revision of Android SDK Tools
     # - tools
     # - platform-tools

     # The BuildTools version used by your project
     - build-tools-26.0.2

     # The SDK version used to compile your project
     - android-26

     # Additional components
     - extra-google-google_play_services
     - extra-google-m2repository
     - extra-android-m2repository

     # Specify at least one system image,
     # if you need to run emulator(s) during your tests
     - sys-img-x86-android-26
     - sys-img-armeabi-v7a-android-17
     - android-$ANDROID_EMULATOR_LEVEL
     - sys-img-armeabi-v7a-google_apis-$ANDROID_EMULATOR_LEVEL	

env:
  global:
    - ANDROID_API_LEVEL=26
    - ANDROID_EMULATOR_LEVEL=21
    - ANDROID_BUILD_TOOLS_VERSION=27.0.3
    - ANDROID_ABI=armeabi-v7a
    - ANDROID_TAG=google_apis
    - ADB_INSTALL_TIMEOUT=20

licenses:
  - '.+'

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/

install: true

before_install:
   - chmod +x gradlew

 script:
  - ./gradlew check connectedCheck --stacktrace  

before_script:
# Create and start emulator.
  - echo no | android create avd --force -n test -t "android-"$ANDROID_EMULATOR_LEVEL --abi $ANDROID_ABI --tag $ANDROID_TAG
  - emulator -avd test -no-window &
  - android-wait-for-emulator
  - adb shell input keyevent 82 &

after_success:
   - bash <(curl -s https://codecov.io/bash) -t token 
